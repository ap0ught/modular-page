<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=8">
  <meta charset="utf-8" />

  <title>gaarf.info - my corner of the internets</title>

  <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.8.1/build/reset-fonts/reset-fonts.css" />

  <style type="text/css" media="screen">
    html {
      background-color: #EEE;
    }
    body {
      margin: 10px;
    }
    h1 {
      font-size: 200%;
      font-weight: bold;
    }
    ul.modules li.module {
      border: 1px solid gray;
      margin:10px 10px 0 0;
      float:left;
    }
    .module h2 {
      font-weight: bold;
      background-color:#CCC;
    }
    .module h2, .module .content {
      padding:3px;
    }
  </style>

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
  <script>

  (function(argument) {
    if (!window.console || !console.firebug) {
      var names = ["log", "debug", "info", "warn", "error", "assert", "dir", "dirxml",
      "group", "groupEnd", "time", "timeEnd", "count", "trace", "profile", "profileEnd"];

      window.console = {};
      for (var i = 0; i < names.length; ++i)
      window.console[names[i]] = function() {}
    }
  })();

  MODULARPAGE = {

    modules: {

      flickr: {
        _id: '94765669@N00',
        _tags: 'flickrrss',
        dimensions: '100x100',
        initAfter: function() {
          var url = 'http://api.flickr.com/services/feeds/photos_public.gne?id='+this._id+'&tags='+this._tags+'&format=json&jsoncallback=?';
          MODULARPAGE.getJSONp(url,this.sKey);
        },
        JSONpCallback: function(data) {
          console.log(this.sKey,data);
          this.$content.html(data.toString());
        }
      },

      twitter: {
        _username: 'gaarf',
        initAfter: function() {
          var url = 'http://twitter.com/status/user_timeline/'+this._username+'.json?count=10&callback=?';
          MODULARPAGE.getJSONp(url,this.sKey);
        },
        JSONpCallback: function(data) {
          console.log(this.sKey,data);
          this.$content.html(data.toString());
        }
      },

      dummy: {
        title: 'A Dummy Module',
        initBefore: function() {
          this.$content.text('this module doesnt do anything fancy...');
        }
      }

    },

    getJSONp: function(url,k) {
      console.info('getJSONp', k, url);
      $.getJSON( url,
        function(data){
          var that = MODULARPAGE.modules[k];
          try {
            that.JSONpCallback(data);
            MODULARPAGE.baseModule.doneLoading.call(that);
          }
          catch(e) {
            console.error(e,that);
          }
        }
      );
    },

    baseModule: {
      initBefore: function() {
        this.$node = $('<li class="loading module '+(this.className || this.sKey)+'">' + 
          '<h2>'+(this.title || this.sKey)+'</h2><div class="content" /></li>');
        this.$content = this.$node.find('.content');
        if(this.initBefore) { 
          console.log(this.sKey,'has initBefore');
          this.initBefore(); 
        }
      },
      initAfter: function() {
        if(this.initAfter) { 
          this.initAfter(); 
        }
        else {
          MODULARPAGE.baseModule.doneLoading.call(this);
        }
      },
      doneLoading: function() {
        this.$node.removeClass('loading');
      }
    },

  };

  $(document).ready(function(){

    var $body = $('body')
      .append($('<h1>'+document.title+'</h1>'))
      .append('<p>This page is written entirely with client-side technologies. ' + 
        'Each module is independent and pulls its own data via JSONP.</p>');

    var $modules = $('<ul class="modules" />');
    
    $.each(MODULARPAGE.modules, function(k){
      this.sKey = k;
      MODULARPAGE.baseModule.initBefore.call(this);
      $modules.append(this.$node);
      MODULARPAGE.baseModule.initAfter.call(this);
    });

    $body.append($modules);
  });

  </script>
</head>
<body>
  <noscript>
    Javascript is required!
  </noscript>
</body>
</html>
